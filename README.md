# Context Collector

一款专为 macOS 设计的轻量级上下文收集工具，通过简单的快捷键操作实现快速文本收集、编辑和归档。

## 项目概述

Context Collector 是一个"仅用于收集与轻编辑"的桌面工具，核心理念是将复杂的"复制→建文件→粘贴→修剪→加粗→归档"流程简化为"一次热键 + 一次保存"。

### 核心工作流程

1. **触发**: 双击 ⌘C 快捷键
2. **弹出面板**: 左侧项目选择器 + 右侧单区编辑器
3. **编辑**: 在同一编辑器中修剪原文、添加注释(`//`)、加粗重点(`**...**`)
4. **保存**: ⌘S 保存为 Markdown 文件

### 设计理念

- **最小可运行**: 极简化操作流程
- **沉浸式语境收集**: 原始材料优先，最低限度结构化
- **文件系统即数据库**: 所有权交给用户，简单直观
- **系统原生能力优先**: 减少不确定性与学习负担

## 技术架构

### 技术栈

- **UI框架**: SwiftUI + 少量 AppKit
- **平台**: macOS 专用
- **文本编辑**: NSTextView 封装到 SwiftUI
- **全局键监听**: CGEventTap (需要辅助功能权限)
- **剪贴板**: NSPasteboard
- **文件操作**: FileManager + 原子写入

### 系统要求

- macOS 10.15+
- 辅助功能权限 (Accessibility Permission)

## 功能特性

### 核心功能 (MVP)

- [x] 双击 ⌘C 全局快捷键触发
- [x] 项目管理和选择器 (含默认 Inbox)
- [x] 单区文本编辑器
- [x] 快捷键支持:
  - `⌘B`: 包裹/取消包裹选中文本为 `**粗体**`
  - `⌘/`: 行首添加/移除 `//` 注释
  - `⌘S`: 保存文件
  - `Esc`: 关闭窗口
- [x] 自动文件命名和归档
- [x] 原子文件写入

### 文件组织结构

```
~/ContextCollector/
├── inbox/
│   └── 2025-08-23/
│       ├── 10-15_untitled.md
│       └── 10-15_untitled-a.md
└── projects/
    └── MyProject/
        └── 2025-08-23/
            └── 10-32_接口梳理.md
```

### 文件命名规则

- **目录结构**: `{projects/<project>|inbox}/YYYY-MM-DD/`
- **文件名格式**: `HH-mm_<title>.md`
- **重名处理**: 添加后缀 `-a`, `-b`, `-c` 等
- **字符清洗**: 非法字符 `\/:*?"<>|` 替换为 `-`
- **默认标题**: 空标题使用 `untitled`

### 不包含的功能 (明确排除)

- ❌ frontmatter 生成
- ❌ 内容去重或防抖
- ❌ 敏感信息检测
- ❌ 媒体文件预览或解析
- ❌ 复杂标注或画框功能
- ❌ 关系可视化
- ❌ Git 集成

## 快速开始

### 安装

1. 克隆项目到本地
2. 使用 Xcode 打开项目
3. 编译并运行

### 首次使用

1. 启动应用后会提示授予辅助功能权限
2. 在系统偏好设置中允许 Context Collector 访问辅助功能
3. 重启应用即可开始使用

### 基本使用

1. 在任意应用中复制文本
2. 快速双击 ⌘C (间隔 < 400ms)
3. 在弹出的面板中编辑文本
4. 选择项目或使用默认的 Inbox
5. 按 ⌘S 保存文件

## 配置选项

### 可配置参数

- **根目录路径**: 默认 `~/ContextCollector`
- **双击时间阈值**: 默认 400ms
- **保存后行为**: 保持窗口打开 / 自动关闭

### 偏好设置位置

应用内设置面板提供所有配置选项的图形界面。

## 开发者指南

### 项目结构

```
ContextCollector/
├── Services/
│   ├── HotkeyService.swift      # 全局键监听
│   ├── ClipboardService.swift   # 剪贴板操作
│   ├── StorageService.swift     # 文件存储
│   └── ProjectsService.swift    # 项目管理
├── ViewModels/
│   └── CaptureViewModel.swift   # 面板状态管理
├── Views/
│   ├── CaptureWindow.swift      # 主界面
│   ├── MarkdownTextView.swift   # 文本编辑器
│   └── PreferencesView.swift    # 设置界面
├── Models/
│   └── Preferences.swift        # 配置模型
└── App.swift                    # 应用入口
```

### 关键模块说明

- **HotkeyService**: 使用 CGEventTap 监听全局键盘事件
- **StorageService**: 处理文件路径生成、命名冲突和原子写入
- **MarkdownTextView**: NSTextView 的 SwiftUI 封装，实现快捷键功能
- **CaptureViewModel**: 管理面板状态和用户交互逻辑

## 测试用例

### 功能测试

- [ ] 双击 ⌘C 触发 (间隔 < 400ms)
- [ ] 文本包裹功能 (`⌘B`)
- [ ] 行注释功能 (行首 `//`)
- [ ] 文件保存功能 (`⌘S`)
- [ ] 重名文件处理
- [ ] 项目切换功能
- [ ] 偏好设置保存

### 边界测试

- [ ] 权限被拒绝的处理
- [ ] 超长文本处理
- [ ] 特殊字符文件名处理
- [ ] 磁盘空间不足处理

## 贡献指南

### 开发规范

- 使用小步提交策略
- 每个模块独立开发和测试
- 保持代码注释清晰
- 遵循 Swift 代码规范

### 提交格式

```
feat: 添加新功能
fix: 修复bug
docs: 文档更新
style: 代码格式调整
refactor: 代码重构
test: 测试相关
```

## 许可证

[MIT License](LICENSE)

## 版本历史

### v1.0.0 (计划中)

- 实现所有 MVP 功能
- 基础 UI 和交互
- 文件管理系统
- 偏好设置

### 未来版本计划

- 性能优化
- 更多快捷键支持
- 主题定制
- 插件系统扩展